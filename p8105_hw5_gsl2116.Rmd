---
title: "P8105 Homework 5"
author: "Grace Liu"
date: "11/8/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(purrr)
```

## Problem 1

```{r participant data, include=FALSE}
dataframe = 
  list.files("./data", pattern = "*.csv", full.names = TRUE) %>% 
  map(read_csv)

for (i in 1:20) {
  if (i <11) {
   dataframe[[i]] = dataframe[[i]] %>% 
     mutate(arm = "Control", study_id = i)
   }
  if (i >10) {
    dataframe[[i]] = dataframe[[i]] %>% 
      mutate(arm = "Experiment", study_id = i-10)
    }
}

participant_data =
  dataframe %>% 
  reduce(rbind) %>% 
  gather(key = week, value = observation, week_1:week_8) %>% 
  separate(week, into = c("remove", "week"), sep = "_") %>% 
  mutate(week = as.numeric(week), study_id = as.character(study_id)) %>% 
  janitor::clean_names() %>% 
  select(arm, study_id, week, observation)
```

```{r study graph}
participant_data %>% 
  group_by(arm, study_id) %>% 
  ggplot(aes(x = week, y = observation, type = study_id, color = arm)) + 
    geom_line() +
  theme_minimal() +
    theme(legend.position = "bottom") +
    labs(x = "Week", y = "Observations", 
         title = "Observations per subject, by week")
```

